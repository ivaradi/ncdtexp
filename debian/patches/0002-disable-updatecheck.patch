Description: Phoning-home version checks should be disabled in Debian packages
Author: Sandro Knau√ü <hefee@debian.org>
Origin: Debian
Forwarded: not-needed
Last-Update: 2019-01-15
---
This patch header follows DEP-3: http://dep.debian.net/deps/dep3/
--- a/src/gui/generalsettings.cpp
+++ b/src/gui/generalsettings.cpp
@@ -149,11 +149,14 @@ void GeneralSettings::loadMiscSettings()
 
 void GeneralSettings::slotUpdateInfo()
 {
+    /* Debian don't want an autoupdater
     // Note: the sparkle-updater is not an OCUpdater
     OCUpdater *updater = qobject_cast<OCUpdater *>(Updater::instance());
     if (ConfigFile().skipUpdateCheck()) {
         updater = nullptr; // don't show update info if updates are disabled
     }
+    */
+    OCUpdater *updater = nullptr;
 
     if (updater) {
         connect(updater, &OCUpdater::downloadStateChanged, this, &GeneralSettings::slotUpdateInfo, Qt::UniqueConnection);
--- a/src/libsync/configfile.cpp
+++ b/src/libsync/configfile.cpp
@@ -556,11 +556,14 @@ bool ConfigFile::skipUpdateCheck(const Q
     if (connection.isEmpty())
         con = defaultConnection();
 
-    QVariant fallback = getValue(QLatin1String(skipUpdateCheckC), con, false);
+    QVariant fallback = getValue(QLatin1String(skipUpdateCheckC), con, true);
     fallback = getValue(QLatin1String(skipUpdateCheckC), QString(), fallback);
 
     QVariant value = getPolicySetting(QLatin1String(skipUpdateCheckC), fallback);
-    return value.toBool();
+    if ( !value.toBool() ) {
+        qDebug() << "debian disabled the UpdateCheck mechanism.";
+    }
+    return true;
 }
 
 void ConfigFile::setSkipUpdateCheck(bool skip, const QString &connection)
